<div class="subtask-board-container">
  <button class="back-btn" (click)="goBack()" aria-label="Back">
    <span class="material-icons">arrow_back</span> Back
  </button>
  <h2>Subtasks Board</h2>
  <div class="kanban-board">
    <div class="kanban-column" *ngFor="let status of statuses">
      <div class="kanban-column-header">{{ status }}</div>
      <div class="kanban-tasks">
        <div
          class="kanban-task"
          *ngFor="let subtask of getSubtasksByStatus(status)"
          [attr.aria-label]="subtask.title"
        >
          <!-- Title (clickable for dialog) -->
          <span
            class="task-title clickable"
            [title]="subtask.title"
            (click)="openSubtaskDialog(subtask)"
          >
            {{ subtask.title }}
          </span>
          <!-- Status Dropdown (below the title) -->
          <select
            class="status-select"
            [ngModel]="subtask.status"
            (ngModelChange)="changeSubtaskStatus(subtask, $event)"
            aria-label="Change subtask status"
          >
            <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
          </select>
          <!-- Delete Button (bottom right) -->
          <button
            class="delete-btn"
            aria-label="Delete subtask"
            (click)="deleteSubTask(subtask); $event.stopPropagation()"
            title="Delete subtask"
          >
            <span class="material-icons">delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Add Subtask Form BELOW all columns -->
  <div class="add-subtask-form">
    <input [(ngModel)]="newSubTaskTitle" placeholder="New subtask title" aria-label="New subtask title" />
    <button (click)="addSubTask()" [disabled]="!newSubTaskTitle.trim()">Add</button>
  </div>
  <!-- Subtask View/Edit Dialog -->
  <div *ngIf="viewingSubtask" class="subtask-view-dialog">
    <div class="subtask-view-content">
      <h3>Edit Subtask</h3>
      <input [(ngModel)]="viewingSubtask.title" placeholder="Title" />
      <textarea [(ngModel)]="viewingSubtask.description" placeholder="Description"></textarea>
      <label>
        <input type="checkbox" [(ngModel)]="viewingSubtask.isCompleted" />
        Completed
      </label>
      <div class="edit-actions">
        <button (click)="saveViewingSubtask()">Save</button>
        <button (click)="closeViewSubtask()">Cancel</button>
        <button class="delete-btn" (click)="deleteSubTask(viewingSubtask)">Delete</button>
      </div>
    </div>
  </div>
</div>